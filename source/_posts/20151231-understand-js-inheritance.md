---
title: å¯¹JSç±»å’Œç»§æ‰¿çš„ä¸€äº›ç†è§£
date: 2015-12-31 11:36:54 +8
tags: [JS, prototype, ç»§æ‰¿, åŸå‹]
category: JS
---

æœ¬æ–‡åªæ€»ç»“æœ€å¸¸ç”¨çš„å®ç°æ–¹æ³•ï¼Œä¸å…·ä½“è®¨è®ºå„ç§å®ç°æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼ˆè¿™äº›å…·ä½“å¯ä»¥çœ‹[ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹](http://book.douban.com/subject/10546125/)ï¼‰ã€‚

ç›´åˆ° ES5ï¼ŒJS ä¹Ÿè¿˜æ˜¯ä¸€ä¸ªæ²¡æœ‰ç±»çš„è¯­è¨€ï¼Œè™½ç„¶ ES6 ä¸­å¯ä»¥ä½¿ç”¨ class å…³é”®å­—ï¼Œä½†æ®è¯´ä¹Ÿåªæ˜¯è¯­æ³•ç³–ã€‚(ä¸çŸ¥é“å¥½ä¸å¥½åƒ Ô…(Â¯ï¹ƒÂ¯Ô…))

### ç±»çš„å®ç°

ç±»çš„ä¸¤ä¸ªåŸºæœ¬å…ƒç´ å°±æ˜¯**å±æ€§**å’Œ**æ–¹æ³•**ã€‚

JS ä¸­ç±»çš„å®ç°æœ‰å¾ˆå¤šç§ï¼Œæ„é€ å‡½æ•°æ¨¡å¼ã€åŸå‹æ¨¡å¼ç­‰ç­‰ï¼Œå„æœ‰å„çš„ä¼˜ç¼ºç‚¹ï¼Œæœ€å¸¸ç”¨çš„æ˜¯æ··åˆäº†æ„é€ å‡½æ•°å’ŒåŸå‹æ¨¡å¼çš„æ··åˆæ¨¡å¼ã€‚

```js
function Person(name) {
  this.name = name;
}

Person.prototype.sayHi = function () {
  console.log('Hi, ' + this.name);
};
```

ä½¿ç”¨æ„é€ å‡½æ•°æ¥æ„é€ **å±æ€§**ï¼Œç„¶åå¾€åŸå‹å¯¹è±¡æ·»åŠ **æ–¹æ³•**ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼š

- æ¯ä¸ªå®ä¾‹ä¹‹é—´ä¸ç”¨å…±äº«å±æ€§ï¼Œæ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„å±æ€§ã€‚ä¹Ÿå°±å¯ä»¥é¿å…å½“å±æ€§ä¸ºå¼•ç”¨ç±»å‹ï¼ˆæ•°ç»„ã€å¯¹è±¡ï¼‰æ—¶ï¼Œä¿®æ”¹ä¸€ä¸ªå®ä¾‹çš„å±æ€§ä¼šå½±å“åˆ°å…¶ä»–å®ä¾‹çš„æƒ…å†µã€‚
- æ¯ä¸ªå®ä¾‹ä¹‹é—´å…±ç”¨åŸå‹å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œå®ç°äº†å‡½æ•°å¤ç”¨ã€‚

### ç»§æ‰¿çš„å®ç°

JS ä¸­ç»§æ‰¿çš„å®ç°ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°ï¼ŒåŸå‹é“¾ç­‰ç­‰ã€‚
å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå½“ç„¶ç»§æ‰¿çš„å°±æ˜¯çˆ¶ç±»çš„**å±æ€§å’Œæ–¹æ³•**ã€‚JS ä¸­ç»§æ‰¿çš„å®ç°ï¼Œæœ€å¸¸ç”¨çš„ä¹Ÿæ˜¯æ··åˆæ¨¡å¼ã€‚

```js
function Student(name, age) {
  Person.call(this, name);
  this.age = age;
}

console.log(Student.prototype.constructor); // Student

Student.prototype = new Person();
// è¡¥å……ï¼æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šè§åˆ°å¦‚ä¸‹æ–¹å¼ï¼Œå…·ä½“åŒºåˆ«è¯·çœ‹ä¸‹ä¸€å°èŠ‚
Student.prototype = Object.create(Person.prototype);

console.log(Student.prototype.constructor); // Person

Student.prototype.constructor = Student; // é‡å†™constructor

Student.prototype.sayAge = function () {
  console.log("I'm " + this.age);
};
```

ä½¿ç”¨**å€Ÿç”¨æ„é€ å‡½æ•°**çš„æ–¹å¼æ¥ç»§æ‰¿**å±æ€§**ï¼Œç„¶åä½¿ç”¨**åŸå‹é“¾**æ¥ç»§æ‰¿**æ–¹æ³•**ã€‚é€šè¿‡å°†å­ç±»çš„åŸå‹å¯¹è±¡æŒ‡å‘çˆ¶ç±»çš„å®ä¾‹ï¼Œå­ç±»çš„å®ä¾‹å°±å¯ä»¥é€šè¿‡åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾åˆ°çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•ã€‚

#### `Object.create` vs `new`

æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šè§åˆ°å¦‚ä¸‹çš„ç»§æ‰¿æ–¹å¼ï¼š

```js
Student.prototype = Object.create(Person.prototype);
```

Object.create - ä¸è°ƒç”¨æ„é€ å‡½æ•°, åŸå‹ prototype ä¸Šä¸ä¼šå­˜åœ¨`undefined`çš„å±æ€§ï¼Œï¼ˆæ„é€ å‡½æ•°ä¸­çš„å±æ€§ä¸ä¼šå­˜åœ¨äºåŸå‹é“¾ä¸Šï¼Œé™¤éåŸå‹é“¾ä¸Šå®šä¹‰äº†è¯¥å±æ€§/æ–¹æ³•ï¼Œä¾‹å¦‚`Person.prototype.sayhi = function(){}`ï¼‰
new - è°ƒç”¨æ„é€ å‡½æ•°, ä½†ç”±äº`Student.prototype = new Person();`æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå› æ­¤`Student.prototype.name === undefined`

ä¸¾ä¸ª ğŸŒ°
https://jsfiddle.net/HiiTea/cfy89tru/embedded/js
å¯ä»¥çœ‹åˆ°ï¼Œstudent çš„åŸå‹é“¾ä¸Šå¤šäº†ä¸€ä¸ª`age: undefined`å±æ€§
![image](https://user-images.githubusercontent.com/36024221/46127882-8f360380-c264-11e8-82af-69f214fe66cc.png)

### é‡å†™å­ç±»æ„é€ å‡½æ•°çš„æ„ä¹‰

`Student.prototype = new Person();`è¿™ä¸€æ­¥å®Œå…¨æ”¹å˜äº† Student åŸå‹å¯¹è±¡çš„å¼•ç”¨ï¼Œ`Student.prototype.constructor` å˜ä¸ºäº† Person åŸå‹å¯¹è±¡çš„ constructorã€‚
~~ä¸ªäººè§‰å¾—é‡å†™`Student.prototype.constructor = Student;`æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Œå¯èƒ½åªæ˜¯**çº¦å®šä¿—æˆçš„ä¸€ç§æ½œè§„åˆ™**ã€‚
äººä»¬é€šå¸¸å¯èƒ½å·²ç»ä¹ æƒ¯äº†ä½¿ç”¨ new æ“ä½œç¬¦çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°çš„ä¸€è‡´æ€§~~

== update 2019/07/11 ==
å•Šï¼Œ4 å¹´çš„å‰çš„æˆ‘æœç„¶ too simple too naive
é‡å†™`Student.prototype.constructor = Student;`é™¤äº†èƒ½ä¿æŒæ„é€ å‡½æ•°ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œè¿˜èƒ½ä½¿`instanceof`è¿ç®—ç¬¦ç»™å‡ºæ­£ç¡®çš„è¿ç®—ç»“æœã€‚

å¦‚æœæ²¡æœ‰é‡å†™ï¼Œ`student instanceof Person` çš„ç»“æœå°†ä¼šæ˜¯`false`ï¼Œå› ä¸º`instanceof`çš„å†…éƒ¨æœºåˆ¶æ˜¯ï¼Œ**åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„`prototype`**
== update end ==

```js
// Student.prototype.constructor = Student; åœ¨ä¸Šé¢çš„ä»£ç ä¸­æ³¨é‡Šæ‰è¿™ä¸€å¥
var xiaobai = new Student('å°ç™½å¦¹å¦¹', 10);
xiaobai.constructor; // Person
```

å½“ä½ åœ¨ä»£ç ä¸­é‡åˆ°ä¸Šé¢è¿™ç§æƒ…å†µï¼Œå¦‚æœä¸å»æŸ¥çœ‹ä¹‹å‰çš„ä»£ç çš„è¯ï¼Œè‚¯å®šä¼šè§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆæ˜æ˜é€šè¿‡ Student æ„é€ å‡½æ•° new äº†ä¸€ä¸ª Student å®ä¾‹ï¼Œè€Œè¿™ä¸ªå®ä¾‹ï¼Œå´è¯´è‡ªå·±çš„æ„é€ å‡½æ•°æ˜¯ Personï¼Ÿï¼ï¼Ÿï¼WTFï¼Ÿï¼

### å‚è€ƒ

[1] http://stackoverflow.com/questions/4012998/what-it-the-significance-of-the-javascript-constructor-property
