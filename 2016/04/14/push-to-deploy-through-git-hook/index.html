<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    å¦‚ä½•é€šè¿‡Gité’©å­è‡ªåŠ¨éƒ¨ç½²(Push to Deploy) | å°ç™½å¦¹å¦¹å†™ä»£ç 
  </title>
  <meta name="description" content="JavaScriptæ˜¯ä¸–ç•Œä¸Šç¬¬äºŒå¥½çš„è¯­è¨€ğŸ˜">
  
  <meta name="keywords" content="
  git,è‡ªåŠ¨éƒ¨ç½²,hook
  ">
  
  <meta name="author" content="HiiTea">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://github.githubassets.com/favicon.ico">
  <link rel="stylesheet" href="/tech/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-52574938-4', 'auto');
  ga('send', 'pageview');
</script>


  
<script>
  var _hmt = _hmt || [];
  (function(){var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?d8749b933af749e1e5ec931bb403628f";
    var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();
</script>


  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/tech/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/tech/archives">Archives</a></li>
        
        
        <li><a href="/tech/categories">Categories</a></li>
        
        
        <li><a href="/tech/tags">Tags</a></li>
        
        
        <li class="desktop-only"><a href="/tech/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="https://avatars2.githubusercontent.com/u/5300359?v=4&amp;s=460"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/tech/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/tech/archives"
           class="header-toolbar-right"> 58 </a>
      </li>
      <li>
        <a href="/tech/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tech/tags"
           class="header-toolbar-right"> 166 </a>
      </li>
      <li>
        <a href="/tech/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/tech/categories"
           class="header-toolbar-right"> 23 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/tech/">å°ç™½å¦¹å¦¹å†™ä»£ç </a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    HiiTea

    <span class="post-date float-right" title="{{moment(1460631577000).format('MMM DD, YYYY, h:mm:ss A')}}">
      
          <i class="fa fa-pencil-square-o"></i>
      
      {{moment(1460631577000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>å¦‚ä½•é€šè¿‡Gité’©å­è‡ªåŠ¨éƒ¨ç½²(Push to Deploy)</h1>
    <p>çœ‹äº†å¥½å¤šè®²é€šè¿‡gité’©å­è‡ªåŠ¨éƒ¨ç½²çš„ï¼Œå¤§å¤šè®²çš„ç»•æ¥ç»•å»ä¹±ä¸ƒå…«ç³Ÿæ€è·¯ä¸€ç‚¹ä¹Ÿä¸æ¸…æ™°â€¦<br>åšäº†ä¸€æ™šä¸Šå®éªŒä¹‹åå¤§æ¦‚æ˜ç™½äº†æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p>
<h3 id="è£¸ä»“åº“ï¼ˆbareï¼‰"><a href="#è£¸ä»“åº“ï¼ˆbareï¼‰" class="headerlink" title="è£¸ä»“åº“ï¼ˆbareï¼‰"></a>è£¸ä»“åº“ï¼ˆbareï¼‰</h3><p>è£¸ä»“åº“è·Ÿæˆ‘ä»¬å¹³æ—¶<code>git clone</code>å¾—åˆ°çš„ä»“åº“ä¸å¤ªä¸€æ ·ï¼Œè£¸ä»“åº“å…¶å®ç›¸å½“äºé€šè¿‡å…‹éš†æ¥çš„ä»“åº“é‡Œçš„<code>.git</code>æ–‡ä»¶å¤¹ï¼Œæ•´ä¸ªè£¸ä»“åº“ä¸­åªæœ‰gitç´¢å¼•ï¼ˆindexï¼‰ï¼Œ<strong>å¹¶æ²¡æœ‰ä»»ä½•ä»£ç ç›¸å…³çš„ä¸œè¥¿</strong>ã€‚è¦å®ç°Push to Deployï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè£¸ä»“åº“ã€‚</p>
<p>åœ¨å…‹éš†æ—¶ä½¿ç”¨ <code>--bare</code>å‚æ•°æ¥å…‹éš†ä¸€ä¸ªè£¸ä»“åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx-bare</span><br></pre></td></tr></table></figure></p>
<h3 id="é’©å­ï¼ˆhookï¼‰"><a href="#é’©å­ï¼ˆhookï¼‰" class="headerlink" title="é’©å­ï¼ˆhookï¼‰"></a>é’©å­ï¼ˆhookï¼‰</h3><p>æ™®é€šä»“åº“<code>.git</code>æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ª<code>hooks</code>æ–‡ä»¶å¤¹ï¼Œè£¸ä»“åº“ä¸‹ç›´æ¥æœ‰ä¸€ä¸ª<code>hooks</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰å„ç§å„æ ·ä»¥<code>.sample</code>ç»“å°¾çš„é’©å­ï¼Œå½“æŠŠ<code>.sample</code>åç¼€åˆ é™¤æ—¶ï¼Œé’©å­å°±æ˜¯æ¿€æ´»çŠ¶æ€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.git</span><br><span class="line">â”œâ”€â”€â”€hooks</span><br><span class="line">â”‚   â””â”€â”€â”€post-update.sample   </span><br><span class="line">â””â”€â”€â”€ ...</span><br></pre></td></tr></table></figure></p>
<p>ä½ å¯ä»¥åœ¨é’©å­æ–‡ä»¶é‡Œå†™ä¸€äº›bashå‘½ä»¤ï¼Œè¢«æ¿€æ´»çš„é’©å­è¢«è§¦å‘æ—¶ä¼šæ‰§è¡Œä½ çš„bashå‘½ä»¤ã€‚</p>
<p>ä¸deployç›¸å…³çš„é€šå¸¸ä½¿ç”¨<code>post-update</code>é’©å­æˆ–è€…<code>post-receive</code>é’©å­<a href="https://www.kernel.org/pub/software/scm/git/docs/githooks.html" target="_blank" rel="noopener">^1</a>ï¼Œå…³äºè¿™ä¸¤ä¸ªé’©å­åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘æ˜¯æ²¡å¤ªçœ‹æ‡‚ï¼Œå¤§æ¦‚çš„ç†è§£æ˜¯è¿™ä¸¤ä¸ªé’©å­è¢«triggerçš„æ—¶å€™æ”¶åˆ°çš„ä¿¡æ¯ä¸ä¸€æ ·ï¼Œå¦‚æœéœ€è¦ç”¨commitçš„ç›¸å…³ä¿¡æ¯æ¥åšä¸€äº›äº‹æƒ…çš„è¯è¦ä»”ç»†ç ”ç©¶ï¼ˆæ¯”å¦‚å¯ä»¥è®¾ç½®æŸä¸ªåˆ†æ”¯æ”¶åˆ°äº†æ¨é€å°±åšç›¸åº”çš„äº‹æƒ…ä¹‹ç±»ï¼‰ï¼Œå…¶ä»–å¦‚æœåªæ˜¯é€šè¿‡bashæ¥è·‘ä¸€äº›nodeç›¸å…³çš„éƒ¨ç½²å‘½ä»¤ï¼Œä¸¤ä¸ªéƒ½å¯ä»¥ã€‚è¿™ç¯‡æ–‡ç« åªç»™ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œè·Ÿåˆ†æ”¯å•Šä»€ä¹ˆçš„éƒ½æ²¡å…³ç³»ï¼Œåªè¦æ”¶åˆ°æ¨é€å°±éƒ¨ç½²ã€‚</p>
<p>è¦å®ç°Push to Deployï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è£¸ä»“åº“ä¸­ç›¸åº”çš„é’©å­æ–‡ä»¶</p>
<h3 id="è£¸ä»“åº“æ˜¯æ€ä¹ˆå·¥ä½œçš„"><a href="#è£¸ä»“åº“æ˜¯æ€ä¹ˆå·¥ä½œçš„" class="headerlink" title="è£¸ä»“åº“æ˜¯æ€ä¹ˆå·¥ä½œçš„"></a>è£¸ä»“åº“æ˜¯æ€ä¹ˆå·¥ä½œçš„</h3><p>å¯ä»¥åœ¨æœ¬åœ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹å…ˆåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“åä¸ºxxx-remoteï¼ˆæ¨¡æ‹Ÿè¿œç¨‹æœåŠ¡å™¨ï¼‰ï¼Œå†åˆ›å»ºä¸€ä¸ªxxx-localä»“åº“ï¼ˆæ¨¡æ‹Ÿæœ¬åœ°ï¼‰ï¼Œå°†xxx-remoteæ·»åŠ ä¸ºæœ¬åœ°ä»“åº“çš„è¿œç¨‹ä»“åº“ï¼Œåœ¨æœ¬åœ°ä»“åº“å†™ä¸€ä¸ª<code>README.md</code>æ–‡ä»¶ï¼Œæäº¤å¹¶push<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx-remote</span><br><span class="line">git init xxx-local</span><br><span class="line">cd xxx-local</span><br><span class="line">git remote add origin ../xxx-remote</span><br><span class="line">echo test123&gt;README.md</span><br><span class="line">git add .</span><br><span class="line">git commit -m &apos;add readme file&apos;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></p>
<p>ä¹‹ååˆ‡æ¢åˆ°è¿œç¨‹ä»“åº“æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹git log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">cd xxx-remote</span><br><span class="line">git log</span><br></pre></td></tr></table></figure></p>
<p>å°†èƒ½å¤Ÿçœ‹åˆ°æœ‰ä¸€æ¡commitè®°å½•ï¼Œæäº¤ä¿¡æ¯æ˜¯ add readme fileï¼Œè¿œç¨‹ä»“åº“æ”¶åˆ°äº†æœ¬åœ°ä»“åº“çš„push</p>
<h3 id="é’©å­æ˜¯æ€ä¹ˆå·¥ä½œçš„"><a href="#é’©å­æ˜¯æ€ä¹ˆå·¥ä½œçš„" class="headerlink" title="é’©å­æ˜¯æ€ä¹ˆå·¥ä½œçš„"></a>é’©å­æ˜¯æ€ä¹ˆå·¥ä½œçš„</h3><p>è¿›å…¥è¿œç¨‹ä»“åº“ï¼Œå°†<code>hooks</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>post-update.sample</code>æ”¹åä¸º<code>post-update</code>ï¼Œæ‰“å¼€å¹¶ç¼–è¾‘ä¸ºå¦‚ä¸‹å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">set -x #æ˜¾ç¤ºæ¯æ¡å‘½ä»¤</span><br><span class="line">echo &quot;push push&quot;</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹æœ¬åœ°ä»“åº“çš„æ–‡ä»¶ï¼Œè¿›è¡Œä¸€æ¬¡æ¨é€ï¼Œå°†ä¼šçœ‹åˆ°è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œäº†ç›¸åº”çš„å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: + echo push push</span><br><span class="line">remote: push push</span><br><span class="line">To ../xxx</span><br><span class="line"> + 41b78ee...055cec9 master -&gt; master (forced update)</span><br></pre></td></tr></table></figure></p>
<h3 id="ä¸€ä¸ªå®Œæ•´çš„åœºæ™¯ä¸¾ä¾‹"><a href="#ä¸€ä¸ªå®Œæ•´çš„åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="ä¸€ä¸ªå®Œæ•´çš„åœºæ™¯ä¸¾ä¾‹"></a>ä¸€ä¸ªå®Œæ•´çš„åœºæ™¯ä¸¾ä¾‹</h3><p>å‡è®¾æœ‰ä¸€å°è¿œç¨‹æœåŠ¡å™¨ä¸Šè·‘ç€ä¸€ä¸ªç½‘ç«™ï¼Œå¸Œæœ›æ¯æ¬¡git pushä¹‹åè¿™ä¸ªç½‘ç«™å°±è‡ªåŠ¨æ›´æ–°ã€‚<br>ä¸ºäº†æ–¹ä¾¿ï¼š</p>
<ul>
<li>å‡è®¾è¿œç¨‹æœåŠ¡å™¨ä¸Šæ”¾äº†<strong>è£¸ä»“åº“</strong>å’Œ<strong>ç½‘ç«™</strong>ï¼Œè‡ªåŠ¨éƒ¨ç½²çš„è¿‡ç¨‹å°±æ˜¯è£¸ä»“åº“æ”¶åˆ°pushä¹‹åæ›´æ–°ä¸€ä¸‹ç½‘ç«™çš„æ–‡ä»¶å¤¹</li>
<li>å‡è®¾ç½‘ç«™éƒ½æ˜¯é™æ€æ–‡ä»¶ï¼Œä¸éœ€è¦é‡å¯web server</li>
<li>å‡è®¾éƒ½åªè€ƒè™‘é»˜è®¤çš„masteråˆ†æ”¯</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦ï¼š</p>
<ol>
<li><p>åœ¨è¿™å°è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œå‡å¦‚åå«xxxã€‚å…‹éš†repoå–åä¸ºwebsiteï¼Œç”¨äºå­˜æ”¾ç½‘ç«™æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx</span><br><span class="line">git clone ./xxx website</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹è¿œç¨‹æœåŠ¡å™¨ä¸‹<code>hooks</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>post-update.sample</code>æ”¹åä¸º<code>post-update</code>ï¼Œç¼–è¾‘ä¸ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">set -x #æ˜¾ç¤ºæ¯æ¡å‘½ä»¤</span><br><span class="line">git reset --hard origin/master #é˜²æ­¢å› ä¸ºforced pushè€Œå¯¼è‡´æ— æ³•checkout</span><br><span class="line">git checkout</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æœ¬åœ°repoæ·»åŠ è¿œç¨‹ä»“åº“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ubuntu@59.64.123.123:home/xxx.git</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>4.åœ¨æœ¬åœ°ä»“åº“ä¿®æ”¹æ–‡ä»¶å¹¶push</p>
<p>è‡³æ­¤æ•´ä¸ªgitè‡ªåŠ¨éƒ¨ç½²çš„è¿‡ç¨‹å°±å®Œæˆäº†</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3>
  </article>
</div>


    
<div class="container disqus-container">
  <div id="disqus_thread"></div>
</div>

<script>
  var disqus_config = function() {
    this.page.url = "https://sabrinaluo.github.io/tech/2016/04/14/push-to-deploy-through-git-hook/";
    this.page.identifier = 1460631577;
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://hiitea-tech.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>





</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://sabrinaluo.github.io/tech" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>Â© 2019 HiiTea</li>
      <li><a href="https://sabrinaluo.github.io/tech">Home</a></li>
      
      <li><a href="https://github.com/sabrinaluo">Github</a></li>
      
      <li><a href="http://weibo.com/206663121">Weibo</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> â¤ Powered by Hexo
    </div>
    </div>
    
    <div class="footer-pageview">
        <a href="https://info.flagcounter.com/mx4Y">
          <img src="//s01.flagcounter.com/count/mx4Y/bg_FFFFFF/txt_000000/border_FFFFFF/columns_3/maxflags_9/viewers_3/labels_0/pageviews_1/flags_0/percent_0/">
        </a>
    </div>
    
  </footer>
</div>


<script>
  (function() {
    var cx = '015579750388200492852:dnpv83myu4a';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/tech/js/main.js"></script>

</body>
</html>
